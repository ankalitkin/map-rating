{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?7e02","webpack:///./src/App.vue?391e","webpack:///./src/views/Home.vue?237e","webpack:///./src/views/Preferences.ts","webpack:///./src/views/MapService.ts","webpack:///./src/components/OverlayDrawer.ts","webpack:///./src/views/Home.vue","webpack:///./src/views/Home.vue?2d60","webpack:///./src/views/Home.vue?1e69","webpack:///./src/App.vue","webpack:///./src/App.vue?0ab4","webpack:///./src/App.vue?4195","webpack:///./src/plugins/vuetify.ts","webpack:///./src/main.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","staticRenderFns","staticStyle","attrs","staticClass","on","paint","_v","_s","state","model","callback","$$v","selected_case","expression","_l","Preferences","my_case","groups","tags","cases","groupsNames","bbox","MapService","queryData","overpassData","amenitiesList","amenitiesTree","cacheDistances","elements","forEach","next","el","keys","filter","accepted","indexOf","split","tag","groupName","xy","getXY","getLatLng","metric","a","b","x","y","bounds","options","unit","format","calcCache","metersPerLatDeg","metersPerLngDeg","lifeCase","latLng","sum","map","func","getRatingByGroupNameTree","getRatingByGroupNameList","reduce","localStorage","getItem","values","query","join","flatMap","group","colon","substring","trim","cond","element","type","lat","lon","center","Error","loadQuery","createQuery","getCachedQuery","cachedData","JSON","parse","setItem","stringify","e","console","warn","removeItem","distance","time","lanLng","nearest","Math","sqrt","minRes","Infinity","pos","getMinimalDistanceMetersList","calcTimeMinutes","calcRating","treeData","getMinimalDistanceMetersTree","grad","defaultGradient","canvas","document","createElement","ctx","getContext","gradient","createLinearGradient","width","height","addColorStop","fillStyle","fillRect","getImageData","imageData","ImageData","bottom","left","top","right","dLat","dLng","counter","lng","rating","getAverageRating","trunc","max","min","r4","_grad","putImageData","colors","dictionary","currentValue","currentIndex","array","lastOverlay","zoom","tileProvider","attribution","url","setView","addTo","latlng","rList","setLatLng","setContent","toFixed","openOn","loadAmenities","error","selectedCase","size","getSize","draw","imageBounds","Promise","resolve","setTimeout","drawRating","removeFrom","toDataURL","opacity","getBounds","getSouth","getWest","getNorth","getEast","component","VBtn","VRadio","VRadioGroup","components","Home","VApp","VMain","use","config","productionTip","vuetify","render","h","$mount"],"mappings":"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","file":"js/app.24fb2a06.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/map-rating/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',[_c('v-main',[_c('Home')],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticStyle:{\"height\":\"800px\",\"z-index\":\"1\"},attrs:{\"id\":\"map\"}}),_c('div',{staticClass:\"pa-4\",staticStyle:{\"z-index\":\"2\",\"position\":\"fixed\",\"left\":\"0\",\"bottom\":\"0\"}},[_c('v-btn',{attrs:{\"disabled\":false},on:{\"click\":_vm.paint}},[_vm._v(\"Раскрасить карту\")]),_c('span',{staticClass:\"ml-4\"},[_vm._v(_vm._s(_vm.state))]),_c('v-radio-group',{model:{value:(_vm.selected_case),callback:function ($$v) {_vm.selected_case=$$v},expression:\"selected_case\"}},_vm._l((_vm.Preferences.cases),function(my_case,i){return _c('v-radio',{key:i,attrs:{\"label\":my_case.name,\"value\":i}})}),1)],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import {AmenityGroup, LifeCase} from \"@/views/Types\";\r\n\r\nexport default class Preferences {\r\n    public static groups: Record<string, AmenityGroup> = {\r\n        \"public_transport\": {\r\n            name: \"Общественный транспорт\",\r\n            tags: [\r\n                \"highway: bus_stop\"\r\n            ]\r\n        },\r\n        \"grocery\": {\r\n            name: \"Магазины и рынки\",\r\n            tags: [\r\n                \"shop: convenience\",\r\n                \"shop: supermarket\",\r\n                \"amenity: marketplace\",\r\n            ]\r\n        },\r\n        \"pharmacy\": {\r\n            name: \"Аптеки\",\r\n            tags: [\r\n                \"amenity: pharmacy\",\r\n                \"healthcare: pharmacy\",\r\n            ]\r\n        },\r\n        \"food\": {\r\n            name: \"Кафе и быстрое питание\",\r\n            tags: [\r\n                \"amenity: fast_food\",\r\n                \"amenity: cafe\",\r\n            ]\r\n        },\r\n        \"kindergarten\": {\r\n            name: \"Детские сады\",\r\n            tags: [\r\n                \"amenity: kindergarten\",\r\n            ]\r\n        },\r\n        \"school\": {\r\n            name: \"Школы\",\r\n            tags: [\r\n                \"amenity: school\",\r\n            ]\r\n        },\r\n        \"clinic\": {\r\n            name: \"Больницы и поликлиники\",\r\n            tags: [\r\n                \"amenity: clinic\",\r\n                \"amenity: hospital\",\r\n                \"amenity: doctor\",\r\n                \"amenity: doctors\",\r\n                \"healthcare: clinic\",\r\n                \"healthcare: hospital\",\r\n                \"healthcare: doctor\",\r\n                \"healthcare: doctors\",\r\n                \"healthcare: centre\",\r\n            ]\r\n        },\r\n        \"hairdresser\": {\r\n            name: \"Парикмахерские\",\r\n            tags: [\r\n                \"shop: hairdresser\",\r\n            ]\r\n        },\r\n        \"cinema\": {\r\n            name: \"Кино\",\r\n            tags: [\r\n                \"amenity: cinema\",\r\n            ]\r\n        },\r\n        \"pub\": {\r\n            name: \"Пабы и бары\",\r\n            tags: [\r\n                \"amenity: pub\",\r\n                \"amenity: bar\",\r\n            ]\r\n        },\r\n        \"nightclub\": {\r\n            name: \"Ночные клубы\",\r\n            tags: [\r\n                \"amenity: nightclub\",\r\n            ]\r\n        },\r\n    }\r\n\r\n    public static cases: LifeCase[] = [\r\n        {\r\n            name: \"Семьянин\",\r\n            groupsNames: [\r\n                \"grocery\",\r\n                \"pharmacy\",\r\n                \"clinic\",\r\n                \"kindergarten\",\r\n                \"school\",\r\n                \"hairdresser\",\r\n                \"public_transport\",\r\n            ]\r\n        },\r\n        {\r\n            name: \"Ответственный студент\",\r\n            groupsNames: [\r\n                \"grocery\",\r\n                \"pharmacy\",\r\n                \"clinic\",\r\n                \"food\",\r\n                \"public_transport\",\r\n            ]\r\n        },\r\n        {\r\n            name: \"Безответственный студент\",\r\n            groupsNames: [\r\n                \"grocery\",\r\n                \"pharmacy\",\r\n                \"clinic\",\r\n                \"food\",\r\n                \"cinema\",\r\n                \"pub\",\r\n                \"nightclub\",\r\n                \"public_transport\",\r\n            ]\r\n        },\r\n    ]\r\n}\r\n\r\n","import {BBox, LifeCase, OverpassElem, XY} from \"@/views/Types\";\r\nimport Preferences from \"@/views/Preferences\";\r\nimport {overpass, OverpassJson} from \"overpass-ts\";\r\nimport {LatLngTuple} from \"leaflet\";\r\nimport haversine from \"haversine\";\r\nimport {kdTree} from \"kd-tree-javascript\";\r\n\r\n\r\nexport default class MapService {\r\n    private static amenitiesList: Record<string, XY[]> = {};\r\n    private static amenitiesTree: Record<string, kdTree<XY>> = {};\r\n    private static accepted = [\"amenity\", \"shop\", \"healthcare\", \"highway\"];\r\n    private static calcCache = {\r\n        metersPerLatDeg: 0,\r\n        metersPerLngDeg: 0,\r\n    }\r\n\r\n    public static async loadAmenities(bbox: BBox): Promise<void> {\r\n        const overpassData = await MapService.queryData(bbox);\r\n        const amenitiesList: Record<string, XY[]> = {}\r\n        const amenitiesTree: Record<string, kdTree<XY>> = {}\r\n        MapService.cacheDistances(bbox);\r\n        overpassData.elements.forEach(next => {\r\n            const el = next as unknown as OverpassElem;\r\n            const tags = el.tags as Record<string, string>;\r\n            Object.keys(tags).filter(key => this.accepted.indexOf(key) >= 0).forEach(key => {\r\n                tags[key].split(/[;, ]/).forEach(value => {\r\n                    const tag = `${key}: ${value}`;\r\n                    Object.keys(Preferences.groups).forEach(groupName => {\r\n                        if (Preferences.groups[groupName].tags.indexOf(tag) >= 0) {\r\n                            if (!(groupName in amenitiesList)) {\r\n                                amenitiesList[groupName] = [];\r\n                            }\r\n                            const xy = MapService.getXY(MapService.getLatLng(el));\r\n                            amenitiesList[groupName].push(xy);\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n        });\r\n        const metric = (a: XY, b: XY) => (a.x - b.x) ** 2 + (a.y - b.y) ** 2;\r\n        Object.keys(amenitiesList).forEach(tag => {\r\n            if (amenitiesList[tag].length > 4000) {\r\n                amenitiesTree[tag] = new kdTree<XY>(amenitiesList[tag], metric, ['x', 'y']);\r\n            }\r\n        });\r\n        MapService.amenitiesList = amenitiesList;\r\n        MapService.amenitiesTree = amenitiesTree;\r\n    }\r\n\r\n    public static cacheDistances(bounds: BBox): void {\r\n        const options: haversine.Options = {unit: 'meter', format: '[lat,lon]'}\r\n        MapService.calcCache.metersPerLatDeg =\r\n            haversine([bounds[0], bounds[1]], [bounds[2], bounds[1]], options) / (bounds[2] - bounds[0]);\r\n        MapService.calcCache.metersPerLngDeg =\r\n            haversine([bounds[0], bounds[1]], [bounds[0], bounds[3]], options) / (bounds[3] - bounds[1]);\r\n    }\r\n\r\n    public static getAverageRating(lifeCase: LifeCase, latLng: LatLngTuple): number {\r\n        const sum = lifeCase.groupsNames\r\n            .filter(groupName => groupName in MapService.amenitiesList)\r\n            .map(groupName => {\r\n                const func = groupName in this.amenitiesTree ?\r\n                    MapService.getRatingByGroupNameTree :\r\n                    MapService.getRatingByGroupNameList;\r\n                return func(groupName, latLng);\r\n            })\r\n            .reduce((a, b) => a + b, 0);\r\n        return sum / lifeCase.groupsNames.length;\r\n    }\r\n\r\n    private static getCachedQuery(): string | null {\r\n        return localStorage.getItem(\"cachedQuery\");\r\n    }\r\n\r\n    private static createQuery(bbox: BBox): string {\r\n        const keys: string[] = [];\r\n        const values: string[] = [];\r\n        let query = `[out:json][bbox:${bbox.join(\",\")}];(\\n`;\r\n        Object.keys(Preferences.groups)\r\n            .flatMap(groupName => Preferences.groups[groupName])\r\n            .flatMap(group => group.tags)\r\n            .forEach(tag => {\r\n                const colon = tag.indexOf(':');\r\n                const key = tag.substring(0, colon).trim();\r\n                if (keys.indexOf(key) < 0) {\r\n                    keys.push(key)\r\n                }\r\n                const value = tag.substring(colon + 1).trim();\r\n                if (values.indexOf(value) < 0) {\r\n                    values.push(value)\r\n                }\r\n            });\r\n        const cond = `~\"^(${keys.join('|')})$\"~\"^(${values.join('|')})$\"`;\r\n        query += `node[${cond}];\\n`;\r\n        query += `way[${cond}];\\n`\r\n        query += `relation[${cond}];\\n`\r\n        query += \");out center;\";\r\n        return query;\r\n    }\r\n\r\n    private static getLatLng(element: OverpassElem): LatLngTuple {\r\n        if (element.type === \"node\") {\r\n            return [element.lat, element.lon];\r\n        }\r\n        if (element.type === \"way\" || element.type === \"relation\") {\r\n            if (!element.center) {\r\n                throw new Error(\"No center data provided\");\r\n            }\r\n            return [element.center.lat, element.center.lon];\r\n        }\r\n        throw new Error(\"Invalid element type\");\r\n    }\r\n\r\n    private static async queryData(bbox: BBox): Promise<OverpassJson> {\r\n        const loadQuery = MapService.createQuery(bbox);\r\n        if (MapService.getCachedQuery() === loadQuery) {\r\n            const cachedData = localStorage.getItem(\"cachedData\");\r\n            if (cachedData) {\r\n                return JSON.parse(cachedData);\r\n            }\r\n        }\r\n        const data = await overpass(loadQuery) as unknown as OverpassJson;\r\n        try {\r\n            localStorage.setItem(\"cachedQuery\", loadQuery);\r\n            localStorage.setItem(\"cachedData\", JSON.stringify(data));\r\n        } catch (e) {\r\n            console.warn(\"Cannot save loaded data to cache\");\r\n            localStorage.removeItem(\"cachedQuery\");\r\n            localStorage.removeItem(\"cachedData\");\r\n        }\r\n        return data;\r\n    }\r\n\r\n    private static calcTimeMinutes(distance: number): number {\r\n        return distance / 5000 * 60;\r\n    }\r\n\r\n    private static calcRating(time: number): number {\r\n        if (time < 2.5) {\r\n            return 5;\r\n        }\r\n        return 12.5 / time;\r\n    }\r\n\r\n    private static getXY(latLng: LatLngTuple): XY {\r\n        return {\r\n            x: latLng[1] * MapService.calcCache.metersPerLngDeg,\r\n            y: latLng[0] * MapService.calcCache.metersPerLatDeg\r\n        };\r\n    }\r\n\r\n    private static getMinimalDistanceMetersTree(data: kdTree<XY>, lanLng: LatLngTuple): number {\r\n        const nearest = data.nearest(MapService.getXY(lanLng), 1);\r\n        return Math.sqrt(nearest[0][1]);\r\n    }\r\n\r\n    private static getMinimalDistanceMetersList(data: XY[], latLng: LatLngTuple): number {\r\n        let minRes = Infinity;\r\n        const xy = MapService.getXY(latLng);\r\n        data.forEach(pos => {\r\n            const d = (pos.x - xy.x) ** 2 + (pos.y - xy.y) ** 2;\r\n            if (d < minRes) {\r\n                minRes = d;\r\n            }\r\n        });\r\n        return Math.sqrt(minRes);\r\n    }\r\n\r\n    private static getRatingByGroupNameList(groupName: string, latLng: LatLngTuple): number {\r\n        const data = MapService.amenitiesList[groupName];\r\n        const distance = MapService.getMinimalDistanceMetersList(data, latLng);\r\n        const time = MapService.calcTimeMinutes(distance);\r\n        return MapService.calcRating(time);\r\n    }\r\n\r\n    private static getRatingByGroupNameTree(groupName: string, latLng: LatLngTuple): number {\r\n        const treeData = MapService.amenitiesTree[groupName];\r\n        const distance = MapService.getMinimalDistanceMetersTree(treeData, latLng);\r\n        const time = MapService.calcTimeMinutes(distance);\r\n        return MapService.calcRating(time);\r\n    }\r\n}\r\n","import {BBox, LifeCase} from \"@/views/Types\";\r\nimport MapService from \"@/views/MapService\";\r\nimport {LatLngTuple} from \"leaflet\";\r\n\r\nexport default class OverlayDrawer {\r\n    private static colors = [\r\n        'transparent',\r\n        'blue',\r\n        'cyan',\r\n        'lime',\r\n        'yellow',\r\n        'orange',\r\n        'red'\r\n    ];\r\n    private static defaultGradient = OverlayDrawer.colors.reduce((dictionary, currentValue, currentIndex, array) => {\r\n        dictionary[currentIndex / (array.length - 1)] = currentValue;\r\n        return dictionary;\r\n    }, {} as Record<number, string>);\r\n\r\n    private static _grad = OverlayDrawer.gradient();\r\n\r\n    private static gradient(grad: Record<number, string> = this.defaultGradient) {\r\n        // create a 256x1 gradient that we'll use to turn a grayscale heatmap into a colored one\r\n        const canvas = document.createElement(\"canvas\");\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error(\"Canvas error\");\r\n        }\r\n        const gradient = ctx.createLinearGradient(0, 0, 0, 256);\r\n\r\n        canvas.width = 1;\r\n        canvas.height = 256;\r\n\r\n        Object.keys(grad).forEach(pos => gradient.addColorStop(+pos, grad[+pos]));\r\n\r\n        ctx.fillStyle = gradient;\r\n        ctx.fillRect(0, 0, 1, 256);\r\n\r\n        return ctx.getImageData(0, 0, 1, 256).data;\r\n    }\r\n\r\n    public static drawRating(bounds: BBox, width: number, height: number, lifeCase: LifeCase): HTMLCanvasElement {\r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error(\"Canvas error\");\r\n        }\r\n        const imageData = new ImageData(width, height);\r\n        const data = imageData.data;\r\n        const bottom = bounds[0];\r\n        const left = bounds[1];\r\n        const top = bounds[2];\r\n        const right = bounds[3];\r\n        const dLat = (top - bottom) / 2 / height;\r\n        const dLng = (right - left) / 2 / width;\r\n        let counter = 0;\r\n        MapService.cacheDistances(bounds);\r\n        for (let lat = top - dLat, i = 0; i < height; i++, lat -= 2 * dLat) {\r\n            for (let lng = left + dLng, j = 0; j < width; j++, lng += 2 * dLng) {\r\n                const rating = MapService.getAverageRating(lifeCase, [lat, lng] as LatLngTuple);\r\n                const r = Math.trunc(Math.max(0, Math.min(255, rating / 5 * 255)));\r\n                const r4 = 4 * r;\r\n                data[counter++] = this._grad[r4];\r\n                data[counter++] = this._grad[r4 + 1];\r\n                data[counter++] = this._grad[r4 + 2];\r\n                data[counter++] = this._grad[r4 + 3];\r\n            }\r\n        }\r\n        ctx.putImageData(imageData, 0, 0);\r\n        return canvas;\r\n    }\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from 'vue'\r\nimport {Component} from \"vue-property-decorator\";\r\nimport * as L from 'leaflet';\r\nimport {BBox, LifeCase} from \"@/views/Types\";\r\nimport MapService from \"@/views/MapService\";\r\nimport Preferences from \"@/views/Preferences\";\r\nimport OverlayDrawer from \"@/components/OverlayDrawer\";\r\n\r\n@Component({})\r\nexport default class Home extends Vue {\r\n  private Preferences = Preferences;\r\n  private map!: L.Map;\r\n  private center: L.LatLngTuple = [51.6618, 39.2020];\r\n  private lastOverlay: L.ImageOverlay | null = null;\r\n  private zoom = 13;\r\n  private selected_case = 0;\r\n  private state = \"Готов\"\r\n\r\n  private tileProvider = {\r\n    attribution: '&copy; <a target=\"_blank\" href=\"https://osm.org/copyright\">OpenStreetMap</a> contributors',\r\n    url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n  };\r\n\r\n  mounted(): void {\r\n    this.map = L.map(\"map\").setView(this.center, this.zoom);\r\n    L.tileLayer(this.tileProvider.url, {attribution: this.tileProvider.attribution}).addTo(this.map);\r\n    this.map.on('click', (e: { latlng: L.LatLng }) => {\r\n      const pos: L.LatLngTuple = [e.latlng.lat, e.latlng.lng];\r\n      const rList = MapService.getAverageRating(Preferences.cases[this.selected_case], pos);\r\n      L.popup()\r\n          .setLatLng(e.latlng)\r\n          .setContent('<b>Рейтинг: </b>' + rList.toFixed(3))\r\n          .openOn(this.map);\r\n    })\r\n  }\r\n\r\n  private async paint(): Promise<void> {\r\n    try {\r\n      this.state = \"Загрузка данных\";\r\n      await MapService.loadAmenities(this.bbox());\r\n    } catch (e) {\r\n      console.error(e);\r\n      this.state = \"Произошла ошибка при загрузке данных\";\r\n    }\r\n\r\n    const selectedCase = Preferences.cases[this.selected_case];\r\n    const size = this.map.getSize();\r\n\r\n    try {\r\n      this.state = \"Предварительная отрисовка\";\r\n      await this.draw((size.x / 8) | 0, (size.y / 8) | 0, selectedCase);\r\n\r\n      this.state = \"Финальная отрисовка\";\r\n      await this.draw((size.x / 2) | 0, (size.y / 2) | 0, selectedCase);\r\n\r\n      this.state = \"Готов\"\r\n    } catch (e) {\r\n      console.error(e);\r\n      this.state = \"Произошла ошибка при отрисовке данных\";\r\n    }\r\n  }\r\n\r\n  private async draw(width: number, height: number, selectedCase: LifeCase): Promise<void> {\r\n    const bbox = this.bbox();\r\n    const imageBounds: L.LatLngBoundsExpression = [[bbox[0], bbox[1]], [bbox[2], bbox[3]]];\r\n    const canvas: HTMLCanvasElement = await new Promise(resolve => setTimeout(() => {\r\n      resolve(OverlayDrawer.drawRating(bbox, width, height, selectedCase));\r\n    }));\r\n    if (this.lastOverlay) {\r\n      this.lastOverlay.removeFrom(this.map);\r\n    }\r\n    this.lastOverlay = L.imageOverlay(canvas.toDataURL(), imageBounds, {opacity: 0.5}).addTo(this.map);\r\n  }\r\n\r\n  private bbox(): BBox {\r\n    const bounds = this.map.getBounds();\r\n    return [bounds.getSouth(), bounds.getWest(), bounds.getNorth(), bounds.getEast()];\r\n  }\r\n\r\n}\r\n\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Home.vue?vue&type=template&id=549db475&\"\nimport script from \"./Home.vue?vue&type=script&lang=ts&\"\nexport * from \"./Home.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VRadio } from 'vuetify/lib/components/VRadioGroup';\nimport { VRadioGroup } from 'vuetify/lib/components/VRadioGroup';\ninstallComponents(component, {VBtn,VRadio,VRadioGroup})\n","\n\n\n\n\n\n\n\n\r\nimport Vue from 'vue';\r\nimport {Component} from \"vue-property-decorator\";\r\nimport Home from \"@/views/Home.vue\";\r\n\r\n@Component({\r\n  components: {Home},\r\n})\r\nexport default class App extends Vue {\r\n\r\n}\r\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--14-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/ts-loader/index.js??ref--14-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--14-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/ts-loader/index.js??ref--14-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=25f34344&\"\nimport script from \"./App.vue?vue&type=script&lang=ts&\"\nexport * from \"./App.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\nimport { VMain } from 'vuetify/lib/components/VMain';\ninstallComponents(component, {VApp,VMain})\n","import Vue from 'vue';\r\nimport Vuetify from 'vuetify/lib/framework';\r\n\r\nVue.use(Vuetify);\r\n\r\nexport default new Vuetify({\r\n});\r\n","import Vue from 'vue'\r\nimport App from './App.vue'\r\nimport vuetify from './plugins/vuetify'\r\n\r\nVue.config.productionTip = false\r\n\r\nnew Vue({\r\n  vuetify,\r\n  render: h => h(App)\r\n}).$mount('#app')\r\n"],"sourceRoot":""}